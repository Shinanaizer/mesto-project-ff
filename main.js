(()=>{"use strict";function e(e,t,o,n,r){const s=document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),c=s.querySelector(".card__image");s.querySelector(".card__title").textContent=e.name,c.src=e.link,c.alt=e.name;const a=s.querySelector(".card__delete-button"),i=s.querySelector(".card__like-button"),u=s.querySelector(".like_counter");return i.addEventListener("click",(()=>{o(e._id,i,u)})),c.addEventListener("click",(function(){n(e)})),e.owner._id===r._id?a.addEventListener("click",(()=>{t(e._id,s)})):a.remove(),u.textContent=`${e.likes.length}`,s}function t(e){e.classList.add("popup_is-animated"),e.classList.add("popup_is-opened"),document.addEventListener("keydown",n),e.addEventListener("click",r)}function o(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",r),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}function r(e){(e.target.classList.contains("popup__close")||e.target===e.currentTarget)&&o(document.querySelector(".popup_is-opened"))}function s(e,t,o){!function(e){return e.some((e=>!e.validity.valid))}(e)?t.classList.remove(o.inactiveButtonClass):t.classList.add(o.inactiveButtonClass)}function c(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((function(o){o.value.replace(/^[\-a-zA-Zа-яА-яёЁ\s]+$/g,""),n.classList.add(t.inactiveButtonClass);const r=e.querySelector(`.${o.id}-error`);o.classList.remove(t.inputErrorClass),r.classList.remove(t.errorClass),r.textContent=""}))}const a=fetch("https://mesto.nomoreparties.co/v1/wff-cohort-26/users/me",{headers:{authorization:"1291abb4-4eb6-4ecd-a69b-ec3b707f9fe4"}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))),i=fetch("https://mesto.nomoreparties.co/v1/wff-cohort-26/cards",{headers:{authorization:"1291abb4-4eb6-4ecd-a69b-ec3b707f9fe4"}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))),u=document.querySelector(".content").querySelector(".places__list"),p=document.querySelector(".profile__add-button"),l=document.querySelector(".popup_type_new-card"),d=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup_type_edit"),_=document.forms["edit-profile"],f=_.elements.name,b=_.elements.description,v=document.forms["new-place"],h=v.elements["place-name"],y=v.elements.link,S=document.querySelector(".popup_type_image"),C=document.querySelector(".popup__caption"),k=document.querySelector(".popup__image"),E=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),L=document.querySelector(".profile__image"),g=document.querySelector(".popup_type_new-avatar"),$=document.querySelector(".profile__image-button"),j=document.forms["new-avatar"],x=j.elements.link,B=document.getElementById("avatar_button"),w=document.getElementById("profile_button"),P=document.getElementById("card_button");$.addEventListener("click",(()=>{t(g)})),j.addEventListener("submit",(function(e){e.preventDefault();const t=x.value;!function(e){var t;B.textContent="Сохранение...",(t=e,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-26/users/me/avatar",{method:"PATCH",headers:{authorization:"1291abb4-4eb6-4ecd-a69b-ec3b707f9fe4","Content-Type":"application/json"},body:JSON.stringify({avatar:`${t}`})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))).then((()=>{B.textContent="Сохранить"})).catch((e=>{console.log(e)}))}(t),L.style.backgroundImage=`url(${t})`,o(document.querySelector(".popup_is-opened")),j.reset(),c(j,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})}));const T=[a],z=[a,i];function A(e){k.src=e.link,C.textContent=e.name,t(S)}var D;function I(e,t){return(o=e,fetch(`https://mesto.nomoreparties.co/v1/wff-cohort-26/cards/${o}`,{method:"DELETE",headers:{authorization:"1291abb4-4eb6-4ecd-a69b-ec3b707f9fe4","Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))).then((()=>{t.remove()})).catch((e=>{console.log(e)}));var o}function N(e,t,o){return t.classList.contains("card__like-button_is-active")?(n=e,fetch(`https://mesto.nomoreparties.co/v1/wff-cohort-26/cards/likes/${n}`,{method:"DELETE",headers:{authorization:"1291abb4-4eb6-4ecd-a69b-ec3b707f9fe4","Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))).then((e=>{t.classList.remove("card__like-button_is-active"),o.textContent=`${e.likes.length}`})).catch((e=>{console.log(e)})):function(e){return fetch(`https://mesto.nomoreparties.co/v1/wff-cohort-26/cards/likes/${e}`,{method:"PUT",headers:{authorization:"1291abb4-4eb6-4ecd-a69b-ec3b707f9fe4","Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}(e).then((e=>{t.classList.add("card__like-button_is-active"),o.textContent=`${e.likes.length}`})).catch((e=>{console.log(e)}));var n}Promise.all(z).then((t=>{E.textContent=t[0].name,q.textContent=t[0].about,L.style.backgroundImage=`url(${t[0].avatar})`,t[1].forEach((function(o){u.append(e(o,I,N,A,t[0]))}))})).catch((e=>{console.log(e)})),p.addEventListener("click",(function(){t(l)})),d.addEventListener("click",(function(){b.value=q.textContent,f.value=E.textContent,c(_,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),t(m)})),_.addEventListener("submit",(function(e){e.preventDefault();const t=b.value,n=f.value;var r,s;q.textContent=t,E.textContent=n,r=n,s=t,w.textContent="Сохранение...",function(e,t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-26/users/me",{method:"PATCH",headers:{authorization:"1291abb4-4eb6-4ecd-a69b-ec3b707f9fe4","Content-Type":"application/json"},body:JSON.stringify({name:`${e}`,about:`${t}`})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}(r,s).then((()=>{w.textContent="Сохранить"})).catch((e=>{console.log(e)})),o(document.querySelector(".popup_is-opened"))})),v.addEventListener("submit",(function(t){t.preventDefault(),P.textContent="Сохранение...";const n=h.value,r=y.value,s={name:"",link:""};var a,i;s.name=n,s.link=r,(a=n,i=r,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-26/cards",{method:"POST",headers:{authorization:"1291abb4-4eb6-4ecd-a69b-ec3b707f9fe4","Content-Type":"application/json"},body:JSON.stringify({name:`${a}`,link:`${i}`})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))).then((t=>{Promise.all(T).then((o=>{u.prepend(e(t,I,N,A,o[0])),P.textContent="Сохраненить"}))})).catch((e=>{console.log(e)})),o(document.querySelector(".popup_is-opened")),v.reset(),c(v,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(D.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);s(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){((e,t,o)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?((e,t,o)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""})(e,t,o):((e,t,o,n)=>{const r=e.querySelector(`.${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)})(e,t,t.validationMessage,o)})(e,r,t),s(o,n,t)}))}))}(e,D)}))})();